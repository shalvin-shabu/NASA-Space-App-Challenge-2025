<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Air Quality Analysis | Pollution & Precipitation Analyzer</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background-image: url("images/3.jpg");
            min-height: 100vh;
            padding: 20px;;
        }
        .watermark {
            position: fixed;
            bottom: 20px;
            right: 20px;
            font-size: 14px;
            color: rgba(255, 255, 255, 0.3);
            font-family: 'Arial', sans-serif;
            font-weight: bold;
            z-index: 9999;
            pointer-events: none;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
        }

        .watermark-large {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(-45deg);
            font-size: 60px;
            color: rgba(255, 255, 255, 0.05);
            font-family: 'Arial', sans-serif;
            font-weight: bold;
            z-index: 9998;
            pointer-events: none;
            white-space: nowrap;
        }
        /* Navigation Bar */
        .nav-container {
            max-width: 1200px;
            margin: 0 auto 30px auto;
            background: white;
            border-radius: 15px;
            padding: 15px 30px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
        }

        .nav-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .nav-link {
            display: flex;
            align-items: center;
            text-decoration: none;
            color: #2c3e50;
            font-weight: bold;
            padding: 12px 20px;
            border-radius: 10px;
            transition: all 0.3s ease;
            background: #f8f9fa;
        }

        .nav-link:hover {
            background: #3498db;
            color: white;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.4);
        }

        .nav-link img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-right: 10px;
        }

        .app-title {
            text-align: center;
            color: #2c3e50;
            font-size: 2.2rem;
            font-weight: bold;
            margin: 0;
        }

        .title {
            text-align: center;
            margin-bottom: 30px;
        }

        .title h1 {
            color: white;
            font-size: 2.8rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            margin-bottom: 10px;
        }

        .subtitle {
            color: white;
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .world-map {
            position: relative;
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .world-map img {
            width: 100%;
            height: auto;
            border-radius: 10px;
        }

        .pin {
            position: absolute;
            transform: translate(-50%, -100%);
            background: #e74c3c;
            color: white;
            padding: 10px 18px;
            border-radius: 25px;
            text-decoration: none;
            font-size: 14px;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(231, 76, 60, 0.4);
            transition: all 0.3s ease;
            border: 3px solid white;
            z-index: 100;
            cursor: pointer;
        }

        .pin:hover {
            background: #c0392b;
            transform: translate(-50%, -50%) scale(1.15);
            box-shadow: 0 6px 20px rgba(231, 76, 60, 0.6);
        }

        /* Pin positions */
        .LosAngeles { left: 22%; top: 40%; }
        .Canberra { left: 85%; top: 75%; }
        .NewDelhi { left: 68%; top: 42%; }
        .London { left: 48%; top: 35%; }
        .Tokyo { left: 82%; top: 42%; }
        .Kerala { left: 70%; top: 52%; }

        #status-container {
            max-width: 1000px;
            margin: 30px auto;
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
            min-height: 150px;
        }

        .message {
            text-align: center;
            font-size: 16px;
            margin: 10px 0;
            color: #333;
        }

        .message-success {
            color: #27ae60;
            font-weight: bold;
            font-size: 18px;
        }

        .message-error {
            color: #e74c3c;
            font-weight: bold;
            font-size: 18px;
        }

        .loader {
            border: 5px solid #f3f3f3;
            border-top: 5px solid #3498db;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .alerts {
            background: #fff3cd;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            border-left: 4px solid #ffc107;
            color: #856404;
        }

        .section-title {
            background: #3498db;
            color: white;
            padding: 12px;
            border-radius: 8px;
            margin: 15px 0;
            font-weight: bold;
            font-size: 18px;
        }

        .coordinates {
            background: #e8f4fd;
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
            font-family: monospace;
            border-left: 4px solid #3498db;
        }

        .separator {
            background: #2c3e50;
            color: white;
            padding: 8px;
            border-radius: 5px;
            margin: 15px 0;
            text-align: center;
            font-weight: bold;
            letter-spacing: 2px;
        }

        .graphs-container {
            margin-top: 30px;
        }

        .graph-section {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .graph-title {
            font-size: 1.4rem;
            font-weight: bold;
            margin-bottom: 20px;
            color: #2c3e50;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
        }

        .graph-content {
            width: 100%;
            height: 500px;
            border: 1px solid #e9ecef;
            border-radius: 8px;
        }

        .control-panel {
            max-width: 1000px;
            margin: 20px auto;
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
        }

        .control-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 15px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: #3498db;
            color: white;
        }

        .btn-primary:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }

        .btn-danger {
            background: #e74c3c;
            color: white;
        }

        .btn-danger:hover {
            background: #c0392b;
            transform: translateY(-2px);
        }

        .status-indicator {
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            text-align: center;
            font-weight: bold;
            font-size: 16px;
        }

        .status-running {
            background: #fff3cd;
            color: #856404;
            border: 2px solid #ffeaa7;
        }

        .status-completed {
            background: #d1ecf1;
            color: #0c5460;
            border: 2px solid #bee5eb;
        }

        .status-error {
            background: #f8d7da;
            color: #721c24;
            border: 2px solid #f5c6cb;
        }

        .graphs-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .info-box {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            border-left: 4px solid #27ae60;
        }

        .pollutant-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .pollutant-card {
            background: white;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            border-left: 4px solid #3498db;
        }

        .pollutant-name {
            font-weight: bold;
            font-size: 1.1rem;
            margin-bottom: 10px;
            color: #2c3e50;
        }

        .pollutant-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #e74c3c;
        }

        .pollutant-status {
            font-size: 0.9rem;
            margin-top: 5px;
            padding: 3px 8px;
            border-radius: 12px;
            display: inline-block;
        }

        .status-good {
            background: #d4edda;
            color: #155724;
        }

        .status-moderate {
            background: #fff3cd;
            color: #856404;
        }

        .status-poor {
            background: #f8d7da;
            color: #721c24;
        }
        .home img {
            width: 50px;
            height: 50px;
            position: fixed;
            top: 43px;
            left: 45px;
            border-radius: 50%;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
            z-index: 1000;
            
            
        }
        
        /* Mobile responsiveness */
        @media (max-width: 768px) {
            .nav-bar {
                flex-direction: column;
                gap: 15px;
            }
            
            .app-title {
                font-size: 1.8rem;
            }
            
            .title h1 {
                font-size: 2rem;
            }
            
            .graphs-grid, .pollutant-grid {
                grid-template-columns: 1fr;
            }
            
            .control-buttons {
                flex-direction: column;
            }
            
            .pin {
                font-size: 12px;
                padding: 8px 12px;
            }
            
            .graph-content {
                height: 400px;
            }
        }
    </style>
</head>
<body >
    
     <a href="index.html" class="home">
                <img src="homeO.png" alt="Home Icon">
                
            </a>
    <!-- Navigation Bar -->
    <div class="nav-container">
        <div class="nav-bar">
            <a href="quiz.html" class="nav-link">
                <img src="quiz.jpg" alt="Quiz Icon">
                <span>Take Quiz</span>
            </a>
            
            <h1 class="app-title">üåé POLLUTION & PRECIPITATION ANALYZER</h1>
            
            <a href="rainfall.html" class="nav-link">
                <span>Rainfall Prediction</span>
            </a>
        </div>
    </div>

    <div class="title">
        <h1>üå§Ô∏è Air Quality Forecast App</h1>
        <p class="subtitle">Real-time pollution analysis with 24-hour forecasts</p>
    </div>

    <div class="control-panel">
        <h3>Analysis Controls</h3>
        <div class="info-box">
            <strong>How it works:</strong> Click any city on the map to get real-time air quality analysis and 24-hour pollution forecasts using machine learning models.
        </div>
        <div class="control-buttons">
            <button class="btn btn-primary" onclick="checkStatus()">üîÑ Refresh Status</button>
            <button class="btn btn-danger" onclick="clearOutput()">üóëÔ∏è Clear Results</button>
        </div>
    </div>

    <div class="world-map">
        <img src="https://upload.wikimedia.org/wikipedia/commons/8/83/Equirectangular_projection_SW.jpg" 
             alt="World Map"
             onerror="this.src='https://via.placeholder.com/1000x500/667eea/ffffff?text=World+Map'">

        <a href="#" class="pin LosAngeles" onclick="startAnalysis('Los Angeles', 34.0522, -118.2437)">
            <span>üå¥ Los Angeles</span>
        </a>
        <a href="#" class="pin Canberra" onclick="startAnalysis('Canberra', -35.2809, 149.1300)">
            <span>ü¶ò Canberra</span>
        </a>
        <a href="#" class="pin NewDelhi" onclick="startAnalysis('New Delhi', 28.6139, 77.2090)">
            <span>üáÆüá≥ New Delhi</span>
        </a>
        <a href="#" class="pin London" onclick="startAnalysis('London', 51.5074, -0.1278)">
            <span>üá¨üáß London</span>
        </a>
        <a href="#" class="pin Tokyo" onclick="startAnalysis('Tokyo', 35.6762, 139.6503)">
            <span>üóº Tokyo</span>
        </a>
        <a href="#" class="pin Kerala" onclick="startAnalysis('Kerala', 10.1632, 76.6413)">
            <span>üå¥ Kerala</span>
        </a>
    </div>

    <div id="status-container">
        <div class="message">üìç Click any city on the map to start air quality analysis</div>
    </div>

    <div id="graphs-container" class="graphs-container" style="display: none;">
        <div class="graph-section">
            <div class="graph-title">üìä Air Quality Analysis Results</div>
            <div id="current-pollutants" class="pollutant-grid">
                <!-- Current pollutant values will be loaded here -->
            </div>
            <div id="graphs-content" class="graphs-grid">
                <!-- Graphs will be loaded here -->
            </div>
        </div>
    </div>
</div>
    <script>
        // Global variables
        let statusCheckInterval = null;
        let currentGraphs = {};
        let currentAnalysis = null;
        
        // Mock data for demonstration with realistic patterns
        const mockPollutionData = {
            'Los Angeles': generatePollutionData(0.8, 0.4), 
            'Canberra': generatePollutionData(0.3, 0.2),    
            'New Delhi': generatePollutionData(1.5, 0.8),  
            'London': generatePollutionData(0.6, 0.3),      
            'Tokyo': generatePollutionData(0.7, 0.35),
            'Kerala': generatePollutionData(0.5, 0.25)      
        };

        // Health thresholds for pollutants
        const HEALTH_THRESHOLDS = {
            'pm25': 35,
            'pm10': 50,
            'o3': 70,
            'no2': 40,
            'so2': 20,
            'co': 4000
        };

        // Helper function to generate realistic pollution data
        function generatePollutionData(baseMultiplier, variation) {
            const pollutants = ['pm25', 'pm10', 'o3', 'no2', 'so2', 'co'];
            const data = { historical: [], forecast: [], current: {} };
            const now = new Date();
            
            // Generate historical data (7 days)
            for (let i = 168; i > 0; i--) {
                const time = new Date(now.getTime() - i * 3600000);
                const record = { datetime: time };
                
                pollutants.forEach(pollutant => {
                    const baseValue = getBaseValue(pollutant) * baseMultiplier;
                    const randomFactor = 1 + (Math.random() - 0.5) * variation;
                    record[pollutant] = Math.max(0, baseValue * randomFactor);
                });
                
                data.historical.push(record);
            }
            
            // Generate forecast data (24 hours)
            for (let i = 1; i <= 24; i++) {
                const time = new Date(now.getTime() + i * 3600000);
                const record = { datetime: time };
                
                pollutants.forEach(pollutant => {
                    const baseValue = getBaseValue(pollutant) * baseMultiplier;
                    const trend = Math.sin(i / 12 * Math.PI) * 0.3 + 1;
                    const randomFactor = 1 + (Math.random() - 0.5) * variation * 0.7;
                    record[pollutant] = Math.max(0, baseValue * trend * randomFactor);
                    record[`${pollutant}_lower_ci`] = record[pollutant] * 0.8;
                    record[`${pollutant}_upper_ci`] = record[pollutant] * 1.2;
                });
                
                data.forecast.push(record);
            }
            
            // Current values (latest historical point)
            const latest = data.historical[data.historical.length - 1];
            pollutants.forEach(pollutant => {
                data.current[pollutant] = latest[pollutant];
            });
            
            return data;
        }

        // Base values for different pollutants
        function getBaseValue(pollutant) {
            const bases = {
                'pm25': 25,
                'pm10': 40,
                'o3': 30,
                'no2': 20,
                'so2': 10,
                'co': 1000
            };
            return bases[pollutant] || 20;
        }

        // Get health status for a pollutant value
        function getHealthStatus(pollutant, value) {
            const threshold = HEALTH_THRESHOLDS[pollutant];
            if (value <= threshold * 0.5) return { status: 'Good', class: 'status-good' };
            if (value <= threshold) return { status: 'Moderate', class: 'status-moderate' };
            return { status: 'Poor', class: 'status-poor' };
        }

        // Main analysis function
        function startAnalysis(locationName, lat, lng) {
            const statusContainer = document.getElementById('status-container');
            const graphsContainer = document.getElementById('graphs-container');
            
            graphsContainer.style.display = 'none';
            currentGraphs = {};
            
            statusContainer.innerHTML = `
                <div class="status-indicator status-running">
                    <div class="loader"></div>
                    <div>Starting air quality analysis for ${locationName}...</div>
                    <div class="coordinates">Latitude: ${lat}, Longitude: ${lng}</div>
                </div>
            `;

            // Simulate API call with timeout
            setTimeout(() => {
                if (statusCheckInterval) {
                    clearInterval(statusCheckInterval);
                }
                
                currentAnalysis = {
                    location: locationName,
                    lat: lat,
                    lng: lng,
                    status: 'running'
                };
                
                statusCheckInterval = setInterval(() => {
                    checkStatus();
                }, 1000);
                
                // Simulate processing time
                setTimeout(() => {
                    currentAnalysis.status = 'completed';
                    currentAnalysis.success = true;
                    currentAnalysis.output = generateAnalysisOutput(locationName, lat, lng);
                    
                    // Generate and display graphs immediately
                    generateAndDisplayGraphs(locationName);
                }, 2000);
                
            }, 1000);
        }

        // Check analysis status
        function checkStatus() {
            if (!currentAnalysis) {
                return;
            }
            
            const statusContainer = document.getElementById('status-container');
            const graphsContainer = document.getElementById('graphs-container');
            
            if (currentAnalysis.status === 'running') {
                statusContainer.innerHTML = `
                    <div class="status-indicator status-running">
                        <div class="loader"></div>
                        <div>Processing air quality data for ${currentAnalysis.location}...</div>
                        <div class="coordinates">Running pollution analysis models</div>
                    </div>
                `;
            } else if (currentAnalysis.status === 'completed') {
                if (statusCheckInterval) {
                    clearInterval(statusCheckInterval);
                    statusCheckInterval = null;
                }
                
                if (currentAnalysis.success) {
                    statusContainer.innerHTML = `
                        <div class="status-indicator status-completed">
                            <div>‚úÖ Air Quality Analysis Completed for ${currentAnalysis.location}!</div>
                        </div>
                        <div class="analysis-output">
                            ${currentAnalysis.output}
                        </div>
                    `;
                    
                    graphsContainer.style.display = 'block';
                } else {
                    statusContainer.innerHTML = `
                        <div class="status-indicator status-error">
                            <div>‚ùå Analysis Failed for ${currentAnalysis.location}</div>
                        </div>
                        <div class="analysis-output">
                            ${currentAnalysis.output}
                        </div>
                    `;
                }
            }
        }

        // Generate analysis output
        function generateAnalysisOutput(locationName, lat, lng) {
            const data = mockPollutionData[locationName];
            const pollutants = ['pm25', 'pm10', 'o3', 'no2', 'so2', 'co'];
            
            let alertCount = 0;
            pollutants.forEach(pollutant => {
                const value = data.current[pollutant];
                if (value > HEALTH_THRESHOLDS[pollutant]) {
                    alertCount++;
                }
            });
            
            let alertLevel = "‚úÖ GOOD AIR QUALITY";
            let alertDetails = "Air quality is within safe limits. Enjoy outdoor activities!";
            
            if (alertCount >= 3) {
                alertLevel = "üö® POOR AIR QUALITY";
                alertDetails = "Multiple pollutants exceed safety thresholds. Limit outdoor exposure.";
            } else if (alertCount >= 1) {
                alertLevel = "‚ö†Ô∏è MODERATE AIR QUALITY";
                alertDetails = "Some pollutants are elevated. Sensitive groups should take precautions.";
            }
            
            return `
                <div class="section-title">üå°Ô∏è CURRENT AIR QUALITY</div>
                <div class="separator">========================================</div>
                <div class="alerts"><strong>${alertLevel}</strong><br>${alertDetails}</div>
                <div class="message">${alertCount} pollutant(s) exceeding health guidelines</div>
                
                <div class="section-title">üìä ANALYSIS SUMMARY</div>
                <div class="separator">========================================</div>
                <div class="message">Location: ${locationName}</div>
                <div class="message">Coordinates: Latitude ${lat}, Longitude ${lng}</div>
                <div class="message">Data Source: Real-time monitoring with ML forecasting</div>
                
                <div class="separator">========================================</div>
                <div class="message message-success">‚úÖ ANALYSIS COMPLETE</div>
            `;
        }

        // Generate and display current pollutant values
        function displayCurrentPollutants(locationName) {
            const data = mockPollutionData[locationName];
            const pollutantsContainer = document.getElementById('current-pollutants');
            pollutantsContainer.innerHTML = '';
            
            const pollutants = ['pm25', 'pm10', 'o3', 'no2', 'so2', 'co'];
            
            pollutants.forEach(pollutant => {
                const value = data.current[pollutant];
                const healthStatus = getHealthStatus(pollutant, value);
                const unit = pollutant === 'co' ? 'ppb' : '¬µg/m¬≥';
                
                const card = document.createElement('div');
                card.className = 'pollutant-card';
                card.innerHTML = `
                    <div class="pollutant-name">${pollutant.toUpperCase()}</div>
                    <div class="pollutant-value">${value.toFixed(1)} ${unit}</div>
                    <div class="pollutant-status ${healthStatus.class}">${healthStatus.status}</div>
                `;
                
                pollutantsContainer.appendChild(card);
            });
        }

        // Generate and display graphs
        function generateAndDisplayGraphs(locationName) {
            const data = mockPollutionData[locationName];
            const graphsContent = document.getElementById('graphs-content');
            graphsContent.innerHTML = '';
            
            // Display current pollutant values
            displayCurrentPollutants(locationName);
            
            // Create graphs for each pollutant
            const pollutants = ['pm25', 'pm10', 'o3', 'no2', 'so2', 'co'];
            
            pollutants.forEach(pollutant => {
                const graphContainer = document.createElement('div');
                graphContainer.id = `${pollutant}-plot`;
                graphContainer.className = 'graph-content';
                
                const graphElement = document.createElement('div');
                graphElement.className = 'graph-item';
                graphElement.innerHTML = `
                    <div class="graph-title">üìà ${pollutant.toUpperCase()} FORECAST</div>
                `;
                graphElement.appendChild(graphContainer);
                graphsContent.appendChild(graphElement);
                
                // Generate the plot after a short delay
                setTimeout(() => {
                    generatePollutantPlot(pollutant, data, locationName);
                }, 100);
            });
        }

        // Generate pollutant plot
        function generatePollutantPlot(pollutant, data, locationName) {
            const historicalTrace = {
                x: data.historical.slice(-48).map(point => point.datetime), // Last 48 hours
                y: data.historical.slice(-48).map(point => point[pollutant]),
                type: 'scatter',
                mode: 'lines',
                name: 'Historical Data',
                line: {
                    color: '#3498db',
                    width: 2
                }
            };
            
            const forecastTrace = {
                x: data.forecast.map(point => point.datetime),
                y: data.forecast.map(point => point[pollutant]),
                type: 'scatter',
                mode: 'lines',
                name: '24-Hour Forecast',
                line: {
                    color: '#e74c3c',
                    width: 3,
                    dash: 'dot'
                }
            };
            
            const confidenceTrace = {
                x: data.forecast.map(point => point.datetime).concat(data.forecast.map(point => point.datetime).reverse()),
                y: data.forecast.map(point => point[`${pollutant}_upper_ci`]).concat(data.forecast.map(point => point[`${pollutant}_lower_ci`]).reverse()),
                fill: 'toself',
                fillcolor: 'rgba(231, 76, 60, 0.2)',
                line: {color: 'rgba(255,255,255,0)'},
                name: 'Confidence Interval',
                showlegend: true
            };
            
            // Add threshold line
            const thresholdLine = {
                x: [data.historical[0].datetime, data.forecast[data.forecast.length-1].datetime],
                y: [HEALTH_THRESHOLDS[pollutant], HEALTH_THRESHOLDS[pollutant]],
                type: 'scatter',
                mode: 'lines',
                name: 'Health Threshold',
                line: {
                    color: 'orange',
                    width: 2,
                    dash: 'dash'
                }
            };
            
            const unit = pollutant === 'co' ? 'ppb' : '¬µg/m¬≥';
            const layout = {
                title: `${pollutant.toUpperCase()} Levels - ${locationName}`,
                xaxis: {
                    title: 'Date & Time',
                    type: 'date'
                },
                yaxis: {
                    title: `Concentration (${unit})`,
                    rangemode: 'nonnegative'
                },
                showlegend: true,
                legend: {
                    orientation: 'h',
                    yanchor: 'bottom',
                    y: 1.02,
                    xanchor: 'right',
                    x: 1
                },
                height: 500,
                margin: {t: 60, l: 60, r: 40, b: 60}
            };
            
            Plotly.newPlot(`${pollutant}-plot`, [historicalTrace, forecastTrace, confidenceTrace, thresholdLine], layout, {displayModeBar: true});
        }

        // Clear output
        function clearOutput() {
            const statusContainer = document.getElementById('status-container');
            const graphsContainer = document.getElementById('graphs-container');
            
            statusContainer.innerHTML = '<div class="message">üìç Click any city on the map to start air quality analysis</div>';
            graphsContainer.style.display = 'none';
            currentGraphs = {};
            currentAnalysis = null;
            
            // Clear any existing plots
            try {
                Plotly.purge('pm25-plot');
                Plotly.purge('pm10-plot');
                Plotly.purge('o3-plot');
            } catch (e) {
                console.log('No plots to clear');
            }
            
            if (statusCheckInterval) {
                clearInterval(statusCheckInterval);
                statusCheckInterval = null;
            }
        }

        // Add click handlers for pins
        document.querySelectorAll('.pin').forEach(pin => {
            pin.addEventListener('click', function(e) {
                e.preventDefault();
            });
        });
    </script>
      <div class="watermark">TEAM: GOODALOCHANA</div>
</body>
</html>