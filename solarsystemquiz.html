<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solar System Quiz - Sequential Flow</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            overflow-x: hidden;
            background: linear-gradient(to bottom, #0a0a2a, #1a1a3a);
            color: #e0e0e0;
            position: relative;
        }

        /* --- Starry Background Effect --- */
        .stars {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }

        .star {
            position: absolute;
            background-color: white;
            border-radius: 50%;
            opacity: 0;
            animation: twinkle linear infinite;
        }

        @keyframes twinkle {
            0% { opacity: 0; transform: scale(0.5); }
            50% { opacity: 1; transform: scale(1); }
            100% { opacity: 0; transform: scale(0.5); }
        }
        /* End Starry Background */

        .container {
            max-width: 850px;
            margin: 40px auto;
            background-color: rgba(30, 30, 60, 0.85);
            padding: 35px;
            border-radius: 12px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(70, 70, 100, 0.7);
            position: relative;
            z-index: 1;
        }

        h1 {
            color: #92b0ff;
            text-align: center;
            margin-bottom: 20px;
            font-size: 2.2em;
            text-shadow: 0 0 10px rgba(146, 176, 255, 0.5);
        }

        /* Score Display */
        #liveScore {
            text-align: right;
            font-size: 1.1em;
            font-weight: bold;
            color: #d0e0ff;
            padding: 0 5px 15px 0;
        }

        /* Question Area */
        #quizQuestionArea {
            min-height: 400px; /* Ensure content box is visible even if content is small */
        }
        
        .question-card {
            background-color: rgba(40, 40, 80, 0.9);
            padding: 25px;
            border-radius: 10px;
            border: 1px solid rgba(90, 90, 120, 0.7);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        .question-card h3 {
            margin-top: 0;
            color: #e0e0e0;
            font-size: 1.2em;
            line-height: 1.5;
            margin-bottom: 15px;
        }

        .options label {
            display: block;
            background-color: rgba(60, 60, 100, 0.7);
            margin: 10px 0;
            padding: 15px;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.2s, border-color 0.2s;
            border: 1px solid rgba(90, 90, 120, 0.7);
            color: #e0e0e0;
        }

        .options label:hover {
            background-color: rgba(80, 80, 120, 0.8);
            border-color: #92b0ff;
        }

        .options input[type="radio"] {
            margin-right: 12px;
            transform: scale(1.1);
            vertical-align: middle;
            pointer-events: none; /* Make label click the only trigger */
        }

        /* Feedback Colors */
        .correct-answer {
            background-color: rgba(40, 150, 40, 0.8) !important;
            border-color: #28a745 !important;
            font-weight: bold;
            color: #fff !important;
        }

        .user-selected-correct {
            background-color: rgba(40, 180, 40, 0.9) !important;
            border-color: #28a745 !important;
            font-weight: bold;
            color: #fff !important;
            box-shadow: 0 0 15px rgba(40, 180, 40, 0.5);
        }

        .user-selected-incorrect {
            background-color: rgba(200, 50, 50, 0.9) !important;
            border-color: #dc3545 !important;
            font-weight: bold;
            color: #fff !important;
            box-shadow: 0 0 15px rgba(200, 50, 50, 0.5);
        }

        .rationale {
            margin-top: 15px;
            padding: 12px 15px;
            border-radius: 8px;
            font-size: 0.95em;
            border-left: 6px solid;
            line-height: 1.4;
        }
        
        .rationale.correct {
            border-left-color: #28a745;
            background-color: rgba(40, 150, 40, 0.2);
            color: #d4edda;
        }

        .rationale.incorrect {
            border-left-color: #dc3545;
            background-color: rgba(200, 50, 50, 0.2);
            color: #f8d7da;
        }

        /* Navigation & Results */
        .nav-buttons {
            display: flex;
            justify-content: flex-end;
            margin-top: 20px;
        }

        .nav-buttons button {
            padding: 12px 25px;
            font-size: 1.1em;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.2s;
        }

        .nav-buttons button:hover:not(:disabled) {
            background-color: #0056b3;
            transform: scale(1.02);
        }

        .nav-buttons button:disabled {
            background-color: #555;
            cursor: not-allowed;
        }

        #results {
            text-align: center;
            margin-top: 40px;
            padding: 30px;
            border-radius: 12px;
            background-color: rgba(50, 50, 100, 0.9);
            border: 2px solid #92b0ff;
            box-shadow: 0 0 20px rgba(146, 176, 255, 0.4);
        }

        #results h2 {
            color: #92b0ff;
            margin-top: 0;
            font-size: 2em;
        }

        #results p {
            font-size: 1.4em;
            font-weight: bold;
            color: #e0e0e0;
            margin-bottom: 25px;
        }

        #resultOptions button {
            margin: 0 10px;
            padding: 12px 30px;
            font-size: 1.1em;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        #tryAgainBtn {
            background-color: #28a745; /* Green */
            color: white;
            border: none;
        }

        #tryAgainBtn:hover {
            background-color: #1e7e34;
        }

        #closeBtn {
            background-color: #dc3544; /* Red */
            color: white;
            border: none;
        }
        
        #closeBtn:hover {
            background-color: #b82c39;
        }
    </style>
</head>
<body>

<div class="stars" id="stars-container"></div>

<div class="container">
    <h1>Solar System & Clean Skies Quiz</h1>
    
    <div id="liveScore">Score: 0 / 10</div>

    <div id="quizQuestionArea">
        </div>
    
    <div class="nav-buttons">
        <button id="nextBtn" disabled>Next Question</button>
    </div>

    <div id="results" style="display: none;">
        <h2>Quiz Complete!</h2>
        <p id="finalScoreText">Your Final Score: 0 / 10</p>
        
        <div id="resultOptions">
            <button id="tryAgainBtn">Try Quiz Again</button>
            <button id="closeBtn">Close Quiz</button>
        </div>
    </div>
</div>

<script>
    // --- FULL QUIZ POOL (REPLACE WITH YOUR 50 QUESTIONS) ---
    const fullQuizPool = [
        // Question 1
        {
          "questionNumber": 1,
          "question": "Which specific atmospheric constituent, monitored by satellites, acts as a primary catalyst for the formation of ground-level (tropospheric) ozone when reacting with Volatile Organic Compounds (VOCs) in the presence of sunlight?",
          "answerOptions": [
            {"text": "Carbon Monoxide ($CO$)", "isCorrect": false, "rationale": "CO is a pollutant, but it is not one of the direct precursor chemicals that react with VOCs to form ground-level ozone."},
            {"text": "Nitrogen Oxides ($NO_x$)", "isCorrect": true, "rationale": "Nitrogen Oxides, primarily from vehicle emissions and industry, are necessary chemical precursors that react with VOCs and sunlight to produce tropospheric ozone."},
            {"text": "Sulfur Dioxide ($SO_2$)", "isCorrect": false, "rationale": "SO₂ is a major precursor for acid rain and sulfate aerosols, not the primary reactant for ozone formation."},
            {"text": "Methane ($CH_4$)", "isCorrect": false, "rationale": "CH₄ is a potent greenhouse gas, but its role in ozone formation is indirect and far less significant than the primary precursors."}
          ]
        },
        // Question 2
        {
          "questionNumber": 2,
          "question": "Which planet in our Solar System is unique because its rotation axis is tilted by about $98^{\\circ}$ relative to its orbital plane, causing its pole to sometimes point almost directly at the Sun?",
          "answerOptions": [
            {"text": "Mars", "isCorrect": false, "rationale": "Mars' axial tilt is similar to Earth's (25°), leading to distinct seasons, but not an extreme tilt."},
            {"text": "Saturn", "isCorrect": false, "rationale": "Saturn has a moderate tilt of 26.7°, which gives it seasons, but it does not roll on its side."},
            {"text": "Uranus", "isCorrect": true, "rationale": "Uranus has the most extreme axial tilt, nearly 90° (specifically 97.8°), causing its unique 'rolling' orbit."},
            {"text": "Neptune", "isCorrect": false, "rationale": "Neptune's tilt is 28.3°,"}
          ]
        },
        // Question 3
        {
          "questionNumber": 3,
          "question": "NASA's Artemis program aims to return humans to the Moon and establish a long-term presence there. The first crewed mission in this series, Artemis II, will focus primarily on which task?",
          "answerOptions": [
            {"text": "Landing astronauts near the lunar South Pole", "isCorrect": false, "rationale": "Landing will be the goal of Artemis III; Artemis II is a precursor mission."},
            {"text": "Orbiting the Moon and returning to Earth without landing", "isCorrect": true, "rationale": "Artemis II is a crucial test flight, carrying a crew on a trajectory around the Moon and back to Earth to verify the spacecraft's systems before a landing attempt."},
            {"text": "Launching the Lunar Gateway space station components", "isCorrect": false, "rationale": "Some Gateway modules are launched separately, but this is not the primary objective of the Artemis II mission itself."},
            {"text": "Deploying a fleet of small lunar rovers", "isCorrect": false, "rationale": "Small rovers are generally deployed by uncrewed commercial lunar payload services, not the crewed Artemis II mission."}
          ]
        },
        // Question 4
        {
          "questionNumber": 4,
          "question": "A team needs to process petabytes of raw, unstructured Earth Observation satellite imagery (TIFF files) before running their air quality model. Which cloud-based storage concept is designed to hold this vast amount of data in its native format for later analysis?",
          "answerOptions": [
            {"text": "Relational Database", "isCorrect": false, "rationale": "Relational databases are structured and not ideal for storing massive volumes of unstructured binary data like raw satellite images."},
            {"text": "Data Warehouse", "isCorrect": false, "rationale": "A data warehouse stores structured, processed data optimized for rapid querying, not raw, native-format files."},
            {"text": "Data Mart", "isCorrect": false, "rationale": "A data mart is a subset of a data warehouse focused on a single business function, which is too small and structured for this task."},
            {"text": "Data Lake", "isCorrect": true, "rationale": "A data lake is a centralized repository that stores all data (structured and unstructured) in its native format at scale, making it perfect for raw satellite imagery."}
          ]
        },
        // Question 5
        {
          "questionNumber": 5,
          "question": "The **H-R Diagram (Hertzsprung-Russell Diagram)** is a fundamental tool in stellar astronomy. What two stellar properties are plotted on its axes?",
          "answerOptions": [
            {"text": "Mass and Diameter", "isCorrect": false, "rationale": "While related, these are not the primary properties plotted; the diagram focuses on observable characteristics related to stellar life cycles."},
            {"text": "Apparent Brightness and Distance", "isCorrect": false, "rationale": "Apparent brightness depends on distance, which confuses the relationship; the diagram plots an intrinsic luminosity value."},
            {"text": "Temperature (Color/Spectral Type) and Luminosity (Absolute Magnitude)", "isCorrect": true, "rationale": "The H-R Diagram plots a star's surface temperature (or its spectral classification/color index) against its total light output (luminosity or absolute magnitude)."},
            {"text": "Age and Chemical Composition", "isCorrect": false, "rationale": "These properties influence a star's position on the diagram but are not the axes themselves."}
          ]
        },
        // Question 6
        {
          "questionNumber": 6,
          "question": "Which NASA Great Observatory, now retired, was designed primarily to study the universe in the **gamma-ray spectrum**?",
          "answerOptions": [
            {"text": "Hubble Space Telescope (HST)", "isCorrect": false, "rationale": "HST observes the visible, near-ultraviolet, and near-infrared parts of the spectrum."},
            {"text": "Chandra X-ray Observatory", "isCorrect": false, "rationale": "Chandra is dedicated to observing the universe in X-rays, a lower energy range than gamma-rays."},
            {"text": "Compton Gamma Ray Observatory (CGRO)", "isCorrect": true, "rationale": "CGRO was the second of the four Great Observatories and specialized in detecting high-energy gamma-rays from sources like pulsars and black holes."},
            {"text": "Spitzer Space Telescope", "isCorrect": false, "rationale": "Spitzer was the infrared member of the Great Observatories program."}
          ]
        },
        // Question 7
        {
          "questionNumber": 7,
          "question": "In the context of 'safer skies' prediction, if a model predicts a high concentration of particulate matter (PM2.5) that is expected to remain localized over a city for several days, this scenario is most likely influenced by what meteorological phenomenon?",
          "answerOptions": [
            {"text": "Strong vertical wind shear", "isCorrect": false, "rationale": "Strong vertical wind shear would promote mixing and dispersion, which would not lead to localized, high-concentration pollution."},
            {"text": "Coastal sea breeze circulation", "isCorrect": false, "rationale": "Sea breezes generally move pollution inland during the day, preventing long-term localization directly over a coastal city."},
            {"text": "Atmospheric temperature inversion", "isCorrect": true, "rationale": "A temperature inversion traps cooler, dense air (and pollutants) near the surface by placing a layer of warmer air above it, preventing vertical mixing and leading to high concentrations."},
            {"text": "Rapidly moving cold front", "isCorrect": false, "rationale": "Cold fronts bring strong winds and turbulence, which effectively clear out and disperse pollution, preventing localization."}
          ]
        },
        // Question 8
        {
          "questionNumber": 8,
          "question": "The **Kuiper Belt** is a large ring of icy bodies and dwarf planets beyond the orbit of Neptune. Which NASA mission provided the first close-up images and data of a Kuiper Belt Object (KBO), Arrokoth?",
          "answerOptions": [
            {"text": "Voyager 1", "isCorrect": false, "rationale": "Voyager 1 studied Jupiter and Saturn and is now in interstellar space, but did not study a KBO."},
            {"text": "Cassini", "isCorrect": false, "rationale": "Cassini was a dedicated Saturn orbiter and did not travel out to the Kuiper Belt."},
            {"text": "New Horizons", "isCorrect": true, "rationale": "After flying past Pluto, the New Horizons spacecraft was retargeted to fly by and collect detailed data on the KBO Arrokoth (formerly Ultima Thule)."},
            {"text": "Juno", "isCorrect": false, "rationale": "Juno is currently in orbit around Jupiter studying its interior structure and magnetic field."}
          ]
        },
        // Question 9
        {
          "questionNumber": 9,
          "question": "If an air quality research team chooses a **Platform as a Service (PaaS)** model for their cloud-based model, what is the key component they **do not** have to manage or maintain themselves?",
          "answerOptions": [
            {"text": "The application code and data", "isCorrect": false, "rationale": "The team must always manage their own custom application code and the data it processes."},
            {"text": "The pricing strategy for cloud resource usage", "isCorrect": false, "rationale": "The user is always responsible for monitoring and managing their own spending and cost optimization."},
            {"text": "The operating system, runtime environment, and middleware", "isCorrect": true, "rationale": "PaaS abstracts the OS, runtime, and middleware away from the user, allowing them to focus solely on deploying and managing their application code."},
            {"text": "The user access and security roles for the application", "isCorrect": false, "rationale": "Identity and access management for the application itself generally remains the user's responsibility, even in a PaaS model."}
          ]
        },
        // Question 10
        {
          "questionNumber": 10,
          "question": "Which terrestrial planet is characterized by an extremely dense atmosphere composed almost entirely of carbon dioxide, resulting in a runaway greenhouse effect and surface temperatures high enough to melt lead?",
          "answerOptions": [
            {"text": "Mars", "isCorrect": false, "rationale": "Mars' atmosphere is primarily $CO_2$, but it is very thin, not dense, and its surface is very cold."},
            {"text": "Mercury", "isCorrect": false, "rationale": "Mercury is virtually airless, with a very tenuous exosphere, not a dense atmosphere."},
            {"text": "Venus", "isCorrect": true, "rationale": "Venus has a thick, $96\\%$ $CO_2$ atmosphere, trapping enormous amounts of heat in a runaway greenhouse effect, making it the hottest planet."},
            {"text": "Earth", "isCorrect": false, "rationale": "Earth's atmosphere is primarily nitrogen and oxygen and sustains life, avoiding a runaway greenhouse effect."}
          ]
        },
        // Question 11
        {
          "questionNumber": 11,
          "question": "The successful deployment and alignment of the **James Webb Space Telescope's (JWST)** primary mirror segments took place while the telescope was orbiting which Lagrange Point?",
          "answerOptions": [
            {"text": "L1 (between the Earth and the Sun)", "isCorrect": false, "rationale": "L1 is used by solar observation satellites like DSCOVR, but JWST needs to be farther away from Earth's heat."},
            {"text": "L2 (on the far side of the Earth from the Sun)", "isCorrect": true, "rationale": "L2 is the ideal location for JWST as it keeps the Sun, Earth, and Moon behind its sunshield, allowing the instruments to cool to necessary operating temperatures."},
            {"text": "L3 (on the far side of the Sun from the Earth)", "isCorrect": false, "rationale": "L3 is too far and difficult to communicate with, making it unsuitable for a complex telescope like JWST."},
            {"text": "L4 (leading the Earth in its orbit)", "isCorrect": false, "rationale": "L4 is used for stable orbits, but it would still expose the telescope to the Sun-Earth-Moon heat, which L2 is designed to block."}
          ]
        },
        // Question 12
        {
          "questionNumber": 12,
          "question": "In Earth observation, what is the term for a quantitative measure of the extinction of light by aerosols (particulate matter) in the atmosphere, which is a key input for modeling 'cleaner skies'?",
          "answerOptions": [
            {"text": "Normalized Difference Vegetation Index (NDVI)", "isCorrect": false, "rationale": "NDVI is used to measure vegetation health, not atmospheric clarity or aerosol concentration."},
            {"text": "Cloud Optical Thickness (COT)", "isCorrect": false, "rationale": "COT measures the amount of light passing through clouds, which is related but is distinct from the total aerosol content in the entire column of air."},
            {"text": "Aerosol Optical Depth (AOD)", "isCorrect": true, "rationale": "AOD is the standard measure derived from satellite and ground instruments to quantify the total column concentration of light-extinguishing aerosols."},
            {"text": "Sea Surface Albedo (SSA)", "isCorrect": false, "rationale": "Albedo is the measure of reflectivity of a surface; SSA measures the reflectivity of the ocean's surface, not the atmospheric particulate load."}
          ]
        },
        // Question 13
        {
          "questionNumber": 13,
          "question": "Europa, a moon of Jupiter, is considered a top candidate for extraterrestrial life primarily because evidence suggests it harbors which of the following features beneath its icy crust?",
          "answerOptions": [
            {"text": "Massive, active volcanoes", "isCorrect": false, "rationale": "While volcanic activity is present on Io, Europa is known for its smooth ice shell and potential subsurface ocean."},
            {"text": "A global subsurface saltwater ocean", "isCorrect": true, "rationale": "Magnetic field data and surface features strongly suggest a vast ocean of liquid water, kept warm by tidal heating from Jupiter, making it a prime candidate for life."},
            {"text": "A dense, nitrogen-rich atmosphere", "isCorrect": false, "rationale": "Europa has only a very thin oxygen exosphere, not a dense atmosphere, which is less relevant than the presence of liquid water."},
            {"text": "Large deposits of pure silica sand", "isCorrect": false, "rationale": "The geology is primarily water ice and rock; sand deposits are not the primary focus for habitability."}
          ]
        },
        // Question 14
        {
          "questionNumber": 14,
          "question": "NASA's TESS (Transiting Exoplanet Survey Satellite) mission detects exoplanets using the **transit method**. What physical characteristic of a star does this method rely on observing?",
          "answerOptions": [
            {"text": "A Doppler shift in the star's light, indicating wobble", "isCorrect": false, "rationale": "The Doppler shift method is the radial velocity method, a different technique than the transit method."},
            {"text": "A periodic dip in the star's observed brightness", "isCorrect": true, "rationale": "The transit method detects exoplanets by observing the slight, periodic decrease in a star's light output when a planet passes in front of it."},
            {"text": "The direct reflection of starlight off the exoplanet's atmosphere", "isCorrect": false, "rationale": "Direct imaging is a separate method, and TESS does not have the angular resolution to use it effectively."},
            {"text": "The gravitational lensing of light from background stars", "isCorrect": false, "rationulerationale": "Microlensing is another distinct method used to detect exoplanets, which relies on gravity, not the star's brightness."}
          ]
        },
        // Question 15
        {
          "questionNumber": 15,
          "question": "When designing a large-scale, automated pipeline to process daily satellite data for air quality prediction, a researcher uses **serverless functions** to automatically crop and reformat images when they arrive. This approach is an example of which cloud service pattern?",
          "answerOptions": [
            {"text": "Infrastructure as a Service (IaaS)", "isCorrect": false, "rationale": "IaaS involves managing virtual machines; serverless functions are a higher level of abstraction than IaaS."},
            {"text": "Containerization (e.g., Docker)", "isCorrect": false, "rationale": "Containers require managing the container runtime; serverless functions completely abstract the underlying infrastructure."},
            {"text": "Functions as a Service (FaaS)", "isCorrect": true, "rationale": "FaaS, or serverless computing, is ideal for event-driven tasks, such as triggering a small piece of code (a function) when a new file arrives in a storage bucket."},
            {"text": "Software as a Service (SaaS)", "isCorrect": false, "rationale": "SaaS provides a complete, off-the-shelf application; this task involves custom code deployment."}
          ]
        }
    ];

    const QUIZ_SIZE = 15; // Set to 15 questions per session
    let currentQuizData = []; 
    let score = 0; 
    let currentQuestionIndex = 0;
    let isAnswered = false; // Flag to check if the current question has been answered

    const quizQuestionArea = document.getElementById('quizQuestionArea');
    const nextBtn = document.getElementById('nextBtn');
    const resultsDiv = document.getElementById('results');
    const finalScoreText = document.getElementById('finalScoreText');
    const liveScore = document.getElementById('liveScore');
    const tryAgainBtn = document.getElementById('tryAgainBtn');
    const closeBtn = document.getElementById('closeBtn');
    const starsContainer = document.getElementById('stars-container');


    // --- UTILITY: SHUFFLE FUNCTION (Fisher-Yates) ---
    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
    }

    // --- CREATE STARRY BACKGROUND ---
    function createStars() {
        const numStars = 100;
        for (let i = 0; i < numStars; i++) {
            const star = document.createElement('div');
            star.className = 'star';
            star.style.width = star.style.height = `${Math.random() * 3 + 1}px`;
            star.style.top = `${Math.random() * 100}%`;
            star.style.left = `${Math.random() * 100}%`;
            star.style.animationDuration = `${Math.random() * 3 + 2}s`;
            star.style.animationDelay = `${Math.random() * 2}s`;
            starsContainer.appendChild(star);
        }
    }


    // --- RENDER SINGLE QUESTION ---
    function renderQuestion(index) {
        if (index >= currentQuizData.length) {
            displayResults();
            return;
        }

        const q = currentQuizData[index];
        const questionNumberDisplay = index + 1;

        // Reset state for new question
        isAnswered = false;
        nextBtn.disabled = true;
        nextBtn.textContent = (questionNumberDisplay === QUIZ_SIZE) ? 'Finish Quiz' : 'Next Question';

        // Build Question Card HTML
        let questionHTML = `
            <div class="question-card">
                <h3>Question ${questionNumberDisplay} of ${QUIZ_SIZE}: ${q.question}</h3>
                <div class="options" id="options-${index}">
        `;

        // Shuffle the answer options for the current question
        const shuffledOptions = shuffleArray([...q.answerOptions]);

        shuffledOptions.forEach((option, optionIndex) => {
            // Using the question index and option index for a unique ID
            const radioId = `q${index}-opt${optionIndex}`;
            questionHTML += `
                <label for="${radioId}">
                    <input type="radio" id="${radioId}" name="question-${index}" value="${option.text}">
                    ${option.text}
                </label>
            `;
        });

        questionHTML += `
                </div>
            </div>
        `;
        
        quizQuestionArea.innerHTML = questionHTML;

        // Attach event listeners to the new labels
        const optionsDiv = document.getElementById(`options-${index}`);
        optionsDiv.querySelectorAll('label').forEach(label => {
            label.addEventListener('click', (event) => {
                // Prevent double scoring if user clicks label multiple times
                if (!isAnswered) {
                    const selectedText = label.querySelector('input[type="radio"]').value;
                    handleAnswer(index, selectedText, label, optionsDiv);
                }
            });
        });

        // Update live score display
        liveScore.textContent = `Score: ${score} / ${QUIZ_SIZE}`;
    }

    // --- HANDLE ANSWER CLICK (INSTANT FEEDBACK & SCORE UPDATE) ---
    function handleAnswer(questionIndex, selectedText, selectedLabel, optionsDiv) {
        const questionData = currentQuizData[questionIndex];
        const correctOptionData = questionData.answerOptions.find(opt => opt.isCorrect);
        const correctText = correctOptionData.text;
        
        const isCorrect = (selectedText === correctText);
        
        // Only increment score if the question hasn't been answered yet
        if (!isAnswered && isCorrect) {
            score++;
        }
        
        isAnswered = true; // Mark question as answered
        nextBtn.disabled = false; // Enable navigation button
        
        // Apply color feedback to the selected label
        selectedLabel.classList.add(isCorrect ? 'user-selected-correct' : 'user-selected-incorrect');

        // Disable all inputs and highlight the correct answer
        optionsDiv.querySelectorAll('label').forEach(label => {
            label.querySelector('input[type="radio"]').disabled = true;
            if (label.querySelector('input[type="radio"]').value === correctText) {
                if (!label.classList.contains('user-selected-correct')) {
                     label.classList.add('correct-answer');
                }
            }
        });
        
        // Show the rationale
        const rationaleDiv = document.createElement('div');
        rationaleDiv.className = `rationale ${isCorrect ? 'correct' : 'incorrect'}`;
        rationaleDiv.innerHTML = `<strong>Rationale:</strong> ${correctOptionData.rationale}`;
        optionsDiv.closest('.question-card').appendChild(rationaleDiv);

        // Update live score display
        liveScore.textContent = `Score: ${score} / ${QUIZ_SIZE}`;
    }

    // --- DISPLAY RESULTS FUNCTION ---
    function displayResults() {
        quizQuestionArea.innerHTML = ''; // Clear question area
        nextBtn.style.display = 'none'; // Hide next button
        liveScore.style.display = 'none'; // Hide live score

        finalScoreText.textContent = `Your Final Score: ${score} / ${QUIZ_SIZE}`;
        resultsDiv.style.display = 'block';
    }
    
    // --- QUIZ START/RESTART FUNCTION ---
    function startQuiz() {
        // Reset global state
        score = 0;
        currentQuestionIndex = 0;
        isAnswered = false;
        resultsDiv.style.display = 'none';
        nextBtn.style.display = 'block';
        liveScore.style.display = 'block';

        // 1. Shuffle the full pool and select subset
        const shuffledPool = shuffleArray([...fullQuizPool]);
        currentQuizData = shuffledPool.slice(0, QUIZ_SIZE);

        // 2. Render the first question
        renderQuestion(currentQuestionIndex);
    }

    // --- EVENT LISTENERS ---
    document.addEventListener('DOMContentLoaded', () => {
        createStars(); // Initialize the background
        startQuiz(); // Start the quiz

        // Next Button Handler
        nextBtn.addEventListener('click', () => {
            if (isAnswered) {
                currentQuestionIndex++;
                renderQuestion(currentQuestionIndex);
            }
        });

        // Try Again Button Handler
        tryAgainBtn.addEventListener('click', startQuiz);

        // Close Button Handler
        closeBtn.addEventListener('click', () => {
            alert('Thank you for taking the quiz! You can close this browser tab now.');
            // Note: JavaScript cannot forcibly close the window/tab unless it was opened by script.
            // This alert provides user feedback.
        });
    });

</script>
</body>
</html>